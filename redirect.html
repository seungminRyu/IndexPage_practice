<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/redirect.css">
    <title>결제코드 생성</title>
</head>
<body>
    <main>
        <div class="wrapper">
            <div class="loading-box">
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
                <div class="loading-dot"></div>
            </div>
            <h2>결제코드를<br>생성 중 입니다.</h2>
        </div>
    </main>
</body>
<script>
    const $main = document.querySelector("main");
    let targetCode;

    if (null === sessionStorage.getItem("maskCode1")) {
        sessionStorage.setItem("maskCode1", JSON.stringify(["0000", "0000", "0000", 4444, 2222]));
        sessionStorage.setItem("maskCode2", JSON.stringify(["0000", "0000", "0000", 9999, 3333]));
    }

    temp = location.href.split("?")[1];
    productType = temp.split("=")[1];

    if (productType === "type1") {
        arr = JSON.parse(sessionStorage.getItem("maskCode1"));
        targetCode = arr.pop();
        sessionStorage.setItem("maskCode1", JSON.stringify(arr));
    } else {
        arr = JSON.parse(sessionStorage.getItem("maskCode2"));
        targetCode = arr.pop();
        sessionStorage.setItem("maskCode2", JSON.stringify(arr));
    }

    setTimeout(() => {
        $main.innerHTML = 
            `<div class="code-wrapper">
            <p>결제코드는</p>
            <div class="code-box"><span class="code">${targetCode}</span></div>
            <p>입니다.</p>
            </div>
            <div class="btn-wrapper">    
            <button class="btn" onclick="onClickBtn()">홈으로 돌아가기</button>
            </div>
            `;
        console.log("time out");
    }, 3000);

    function onClickBtn() {
        location.href = "index.html";
    }
</script>
</html>